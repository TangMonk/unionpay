<?php

/*
 * This file is licensed under GPLv2+.
*/

/**
 * @file
 * Provides UnionPay interface for drupal.
 */

/**
 * Implementation of hook_menu().
 */
function unionpay_menu() {
	$items['admin/config/services/unionpay'] = array(
		'title' => 'Unionpay settings',
		'description' => 'Unionpay merchant settings.',
		'access arguments' => array('access administration pages'),
		'page callback' => 'drupal_get_form',
		'page arguments' => array('unionpay_admin_form'),
	);
	$items['charge/unionpay'] = array(
		'access callback' => 'unionpay_response_access',
		'type' => MENU_CALLBACK,
		'page callback' => 'unionpay_response',
	);
	return $items;
}

function unionpay_admin_form($form, $form_state) {
	$form['weixinname'] = array(
		'#type' => 'textfield',
		'#title' => t('Site global weixin account name'),
		'#description' => t('Weixin account name to display in binding page.'),
		'#default_value' => variable_get('weixinname', ''),
		'#required' => TRUE,
	);
	$form['weixinid'] = array(
		'#type' => 'textfield',
		'#title' => t('Site global weixin id'),
		'#description' => t('Messages sent to other weixinid will be ignored automatically.'),
		'#default_value' => variable_get('weixinid', ''),
		'#required' => TRUE,
	);
	$form['weixintoken'] = array(
		'#type' => 'textfield',
		'#title' => t('Token'),
		'#description' => t('The token set in weixin public platform.'),
		'#default_value' => variable_get('weixintoken', ''),
		'#required' => TRUE,
	);
	return system_settings_form($form);;
}

function unionpay_admin_form_submit($form, $form_state) {
	variable_set('weixinname',$form_state['values']['weixinname']);
	variable_set('weixinid',$form_state['values']['weixinid']);
	variable_set('weixintoken',$form_state['values']['weixintoken']);
}

